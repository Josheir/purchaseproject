
  <!DOCTYPE html>
<html>

  <head>

    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	<script src="node_modules/js-big-decimal/dist/web/js-big-decimal.min.js"></script>
</head>  


<body>
	

<style>
	

	.form {
    
    
    width: 68%;
	margin: 0 auto; 
   
}

</style>
	


  <script>

window.sessionStorage

var MAXRECORDS = 4;
const MAXKEYWORDS = 4;

var var1 =1;
var var2 =1;
var var3 ;
var3 = var1 + var2;
//

function checkForPassword()
{
	alert("is it here?");
	var isThereACorrectPassword = sessionStorage.getItem("sessionUserID");
	
	//is no password
	if (!isThereACorrectPassword)
	{
	//alert("is here the password");
	window.location.href = "login.html";
	}
	
	//const button = document.createElement('button');
	//button.innerText = 'Can you click me?';

	test();

	
	
}



//https://stackoverflow.com/questions/51300809/load-html-first-before-javascript
//https://stackoverflow.com/questions/588040/window-onload-vs-document-onload
//https://www.skillsugar.com/how-to-use-document-onload-in-javascript

	//document.getElementById("search").style.visibility = "hidden";
	//document.getElementById("button7").style.visibility = "hidden";
	//document.getElementById("button8").style.visibility = "hidden";
	//document.getElementById("button6").style.visibility = "hidden";
	
	checkForPassword();


</script>


     <div id = "wholeGui">
    <input   id="button7"  type="button" value="checkout" />
	  
      <input    name = "search" type="text" id="search" name="search" placeholder= "apple1" value="apple1"/>
      <input   id="button6" type = "button" onclick = "displayFromSearch('0')" value="Search" />
	  <input   id="button8" type = "button" onclick = "resetCall()" type="button" value="Reset"/>
	

      <br>
      <div id = "firstdiv" ></div>
      <br>
      <div id ="buttons"></div>
      <br>
      <div id ="templateOneHere"> </div>
     

      
     
      
      <div id = "lastdiv"></div>
	</div>
	<h6>v11</h6>
<script>



	
	
		
		
		var array = [];
		var storedArray  = [];
		var productIDArray = [];
		
		var globtest = 0;


		///////////

		
		//pudhed reset button in index
		function resetCall()
		{
			//sessionStorage.setItem("amtOfKeywords", 0);


			//sessionStorage.clear();
			//program reprints search box and buttons
			var urlValue = "http://localhost/purchaseproject/index.html";
			var val1 = sessionStorage.getItem("sessionUserID");
			
			sessionStorage.clear();
			alert("c");
			alert(val1);
			sessionStorage.setItem("sessionUserID", val1);
			
			window.location.assign(urlValue);
			
		}



		///////////



		//pushed search (button 6) display1
		function displayFromSearch( )
		{

			//keeeps track of keywords displaying, only so many allowed
			let amt1 = sessionStorage.getItem("amtOfKeywords");
			if (amt1 != null)
			{
			let gAmt1Int = Number(amt1);
			//this is the maximum record limit
			if(gAmt1Int >= 5)
			{
				
				return(1);
			}
			}	
			

			
			

			
		//check for login
		
	
		var getUser = sessionStorage.getItem("sessionUserID");
		
		
		if (getUser == null)
		{
			
			return(1);
		}


	  
		
		var querystring = "";
		var counter = -1;
		
		
		var string = "";
        let keys = Object.keys(sessionStorage);


		var searchWord = "";
		
		

		//build query fo main.go display of order template
		for(let key of keys) {
		
			
		

		if(key ==  "numberOfRecordsChosen")
		{
			
			continue;
		}
		//if(key ==  "alreadyZero")
		//{
	//		
	//		continue;
	//	}
		if(key =="amtOfKeywords")
		{
			continue;
		}

		if(key == "keywords")
  		{
		counter++;
		
		var item = sessionStorage.getItem(key);
		
		
		array = JSON.parse(item);
	    


		}
		
		///////////////
		
        
        var wasKeys = "no";

		var keyAsInt =  parseInt(key); 
		
		//console.log(keyAsInt);
		if (key != "sessionUserID" && key != "keywords" && key != "numberOfRecordsChosen" && key != "amtOfKeywords"  ) 
		{

			

			
			var item = sessionStorage.getItem(key);
			
			
       		string =  string + "id=" + key + "&amtTryingToPurchase=" + item + "&";
			
			
			
  
       		
			   
		}
		
		else if(key == "sessionUserID")
        {
			
			var item = sessionStorage.getItem(key);
			string = string + "uid="  + item + "&";
        }
		else if(key == "keywords")
		{
			wasKeys = "yes";
		}

 	// keyword checked below after ajax
	}  //for keyword loop



		

		
		
		//from index top gui
		var searchWord = document.getElementById("search").value;

	  
	  
		


	  //check if this keyword has any records, already have these records needs to be consideree
	  //return yes or no to include  this in keyword list
	  
	  if(searchWord == "" )
	  {
			return(1);
	  }

	  

//storedarray has only the relevant keywords

//a new keyword, update here
let amt2 = sessionStorage.getItem("amtOfKeywords");
let amt2int = Number(amt2);
if (amt2 == null )
{
	sessionStorage.setItem("amtOfKeywords", 1);

}
else
{
	amt2int++;
	sessionStorage.setItem("amtOfKeywords", amt2int);
}



////////




	  var val2 = [];
     
	  
		
		
	  //returns flag if already a keyword and the string that is and the built query 
		val2 = DoesKeywordAlreadyExist(searchWord, string);
	  
	    
		
		
		querystring = string;
		querystring += val2[1];
		
		var url = "";
	
	  
	  
	 

	  
	  




			





			
			

			 
			 
				//searchWord = "here";
				var b = 0;
			 $.ajax({
                url: "http://localhost:8080/displayOrderFormFromTemplate",
                type: 'POST',
                dataType: 'html',
                data: querystring,
				
				crossDomain: true,
                success: function (result) {

					
					
					console.log("result")
					console.log(result);

					if(result == "")
					{
						return(1);
					}


					
					
			
			 
					

				//ourNewWord2 = result;

				

				
                //var result1 = "";
				//let keys = Object.keys(sessionStorage);

				
				//var  gkeywordArray = "";
				
				//var retVals = [];
				
				//var toRemove = "null";
				//result = result.replaceAll(toRemove, '');



				
				
				//console.log(result2);
				//console.log(result);
				//retVals = forBuildingHTML(result, searchWord);
				
				
				//fix this, here, done
				//var item1 = retVals[0];  
				
				var ourNewWord2 = searchWord; //
				
				//var item = retVals[2]; 
				
				
				
				
				
				

				
				//fix this, here, done
				//var val1a = '"' + item1 +  '"';   
				
				

////////


				
				
				
				
				

				////////////
				//displays link for every grouping by product group to go there
				result1a = "<a href='#" + searchWord + "'>" + searchWord + "</a><br>";
				
				
				document.getElementById('buttons').innerHTML   += result1a;
			  	

				document.getElementById('templateOneHere').insertAdjacentHTML('beforeend',result);

              
                }
         //both jquery
      });
		

	  		
	  		
		};


	  


  

  //checkout button from top of index file
  $(document).ready(function () {
      $('#button7').click(function () {
              

             window.location.href = "callTemplateTwo.html?fromCallTemplate = 1&";

              
              
                });  
              });
              ////////////

/*
//not used...
function uploadandProcessImage(){


///////////////////////////////////
//https://stackoverflow.com/questions/25493706/ajax-upload-file-to-golang-server-with-content-type-multipart
var xhr = new XMLHttpRequest();
   


    var input = document.querySelector('input[type=file]'),
    file = input.files[0];

    
var formdata = new FormData();
formdata.append("file", file);
xhr.open("POST", "localhost:8080/upload", true);
//xhr.setRequestHeader("content-type", "multipart/form-data; charset=utf-8; boundary=" + boundary);
xhr.send(formdata);

///////////////////////////////////

}
*/

var gTotalOfPurchases = 0;

//template number one presses submit this and changes values in quantity and amount purchased
//needs to reduce numberOfRecordsChosen by one when changed to zero first time
//template1, enters a zero...



//////////////////////////////////////

//THERE COULD BE MISTAKES IN NEXT TWO FUNCTIONS

///////////////////////////////////////

//on submit, updates the individual printed interface from same template1


function submitChangesOnOrderTemplates(mainDiv, productID, amountPurchasedID, amountPurchasingID, amountToPurchaseID)
{

	
				
      //amount held for subtraction when submit button pressed
         amountToBePurchased = Number(document.getElementById(amountToPurchaseID).value);
         if (Number(amountToBePurchased) == 0)
         {
            return(-1);
         }
				var makeYellow = document.getElementById(mainDiv);
				makeYellow.style["background-color"] = "yellow";
				
				
				var amountToBePurchased  = 0;
				var  amountInPurchasedField = 0;
				var amountPurchasedToDeductFromToPurchase = 0;
				var value1 = 0;
				var value2 = 0;
				//total of product with server
				amountInPurchasedField = Number(document.getElementById(amountPurchasedID).value);
				//already purchased
				amountPurchasedToDeductFromToPurchase = Number(document.getElementById(amountPurchasingID).value);

				
				
				

				

				//if(amountInPurchasedField - amountToBePurchased != 0)
				//{
				//	
				//}


				

				
				//if there is enough product go in here - take from quantity amount
				if((parseInt(amountInPurchasedField) >= parseInt(amountToBePurchased))   )//&& parseInt(amountToBePurchased) > 0  )
				{

					
					//
					value1 = Number(document.getElementById(amountToPurchaseID).value); 
					
					//value2 = amountopurchase + amountpurchaseedsofar
					value2  = parseInt(value1) + parseInt(amountPurchasedToDeductFromToPurchase);
					if(value2 < 0)
					{
						Number(document.getElementById(amountToPurchaseID).value = 0);
						return;
					}
					
					
					//puts total in here
					Number(document.getElementById(amountPurchasingID).value = value2) ;
					
					if(value1 > 0){

						
						Number(document.getElementById(amountPurchasedID).value = parseInt(amountInPurchasedField) - parseInt(amountToBePurchased)) ;
					}else if (value1 == 0)
					{
						
					}

					//negative value for amount to purchase
					//value
					else if ( (parseInt(amountPurchasedToDeductFromToPurchase) + parseInt(value1)) > -1){
						
						Number(document.getElementById(amountPurchasedID).value = parseInt(amountInPurchasedField) - parseInt(amountToBePurchased)) ;
						
						Number(document.getElementById(amountToPurchaseID).value = 0);
					}


					
					
					gTotalOfPurchases =  parseInt(gTotalOfPurchases) +  parseInt(amountToBePurchased); 
					
					
					
					//if(gTotalOfPurchases > 0){
                        Number(document.getElementById(amountToPurchaseID).value = 0);
                        
						
						//so far, so good is still in database!
						//amount purchased, quantity, amount to purchase
						//SetDataFromOrderTemplateOnSubmit(amountPurchasedToDeductFromToPurchase, amountInPurchasedField, productID, amountToBePurchased, 0)
						//var boole = true;
						SetDataFromOrderTemplateOnSubmit(amountToPurchaseID, amountPurchasedID, productID,	amountPurchasingID);

                        return (1);
                    //}

					


	
				}
    
				
				
	
	
			}


			var alreadyZeroArray = [];
      //called from submitChangesOnOrderTemplates because of submit button for display1
	  //numberofrcords is set in logon and should have two new sets in this only fucntion (only)
	  //in here :  sessionStorage.setItem(parseInt(productID), parseInt(totalquantity));
 
	  //var gLastQuantity = 0
      //function  SetDataFromOrderTemplateOnSubmit(amountPurchasedToDeductFromToPurchase, quantityOfProduct, productID, amountToPurchase, reduceBool)
	  
	   //amountToPurchase = amounttobepurchasedID//
	   //var boole = true;
	  
	   //deals with to many records
	  function SetDataFromOrderTemplateOnSubmit (amountToPurchaseID, quantityOfProductID, productID, amountPurchasedID) 
	  {

			  let storedArray = [];
			  var gLastQuant = false;
		  	   //amount purchased
			  var amountPurchasedToDeductFromToPurchase =  document.getElementById(amountPurchasedID).value;
			   //amount to purchase 
			  var amountToPurchase  = document.getElementById(amountToPurchaseID).value;

			  var quantityOfProduct  = document.getElementById(quantityOfProductID).value;
				
				var firstArray = [];
				
				let val = "";
				//var storedArray = JSON.parse(sessionStorage.getItem("alreadyZero"))
				
				let val1 = ""
				let val1int = 0;
				let val2int = 0;

				//product line that has been purchased
				val1 = sessionStorage.getItem("numberOfRecordsChosen")


			///////////////

			//amountpurchased
			val1int = parseInt(amountPurchasedToDeductFromToPurchase);

			//amount to purchase
			val2int = parseInt(amountToPurchase);

			totaledPurchased = val1int + val2int;

			//no records yet
			if(val1 == 0)
			{

				
				if (totaledPurchased <= 0 )
				{
					sessionStorage.setItem("numberOfRecordsChosen", 0);
				}
				else 
				{

					sessionStorage.setItem("numberOfRecordsChosen", totaledPurchased);
					
				}

				
				


			}//already has records
			else{


				if (totaledPurchased <= 0 )
				{
					
					sessionStorage.setItem("numberOfRecordsChosen", 0);
				}
				else 
				{
					
					
					let numRecords = sessionStorage.getItem("numberOfRecordsChosen");
					let intNumRecords = parseInt(numRecords);
					intNumRecords++;
					sessionStorage.setItem("numberOfRecordsChosen", intNumRecords);

					
				
				}

					
			}



			///////////////


				
			
		//updates everything for to many records
		if(val1 == sessionStorage.getItem("numberOfRecordsChosen"))
		{
		
		if (val1 == MAXRECORDS-1)
		{
			
		}
		else if (val1 >= MAXRECORDS){

			alert("AT RECORD MAXIMUM, YOU MUST REMOVE A RECORD TO RETURN TO PURCHASE!!!!");
		

			alert(document.getElementById(quantityOfProductID).value);

			//quantity
			document.getElementById(quantityOfProductID).value = document.getElementById(quantityOfProductID).value + parseInt(amountPurchasedToDeductFromToPurchase).value;
			//amount purchased
			document.getElementById(amountPurchasedID).value =  document.getElementById(amountPurchasedID).value - parseInt(amountPurchasedToDeductFromToPurchase).value;
			   //amount to purchase 
			document.getElementById(amountToPurchaseID).value = document.getElementById(amountToPurchaseID).value - parseInt(amountToPurchase).value ;
			
			//alert(document.getElementById(quantityOfProductID).value);
			return(1);

		}


			
			
			//subtract amountpurchased
			//subtract quantity




			
		}
	
		
				



				
				

//------------------------------------
				
				

				let string = "";
				
				let keyFlag = "";
				let bought, totalquantity = 0;
				val1 = "";

				

				let keys = Object.keys(sessionStorage);
				
				for(let key of keys) {
					
				
				//total the quantity and overwrite - is already a record

				//is a productid record with an amount to buy
				if(key == (productID.toString())){
				
					
					keyFlag = "found";
					
					
					//quantity - set in doekeywordalreadyexist
					bought = sessionStorage.getItem(key);
					
					totalquantity = 0;
					
					totalquantity = parseInt(bought) + parseInt(amountToPurchase);
						
					
								
					
					sessionStorage.removeItem(productID);
					
					//updates
					sessionStorage.setItem(parseInt(productID), parseInt(totalquantity));
					//sessionStorage.setItem(parseInt(productID), parseInt(amountPurchasedToDeductFromToPurchase));
					
					
					
						





				
					}
				}//keys for

				
				//is a productId record with a amount to buy
				if (keyFlag !=  "found")
				{

					
					
					//sessionStorage.setItem( parseInt(productID),  parseInt(amountPurchasedToDeduct));
					sessionStorage.setItem( parseInt(productID),  parseInt(amountPurchasedToDeductFromToPurchase));
				
					
					
					


					

					
				}
				}
			
				


			



//returns querystring
//thi function checks if a keyword is already used and returns the queystring

//check if keyword exists already
function DoesKeywordAlreadyExist( searchword, string)
{//NO URLS

	
	
	
	//this flag means that this is a display that returned from template2, so is a special condition
	//if(flag2 == "1")
	//{
	//	querystring = ("var=" + val1 + "&");
	//	//cause a reaction by lieing about this
	//	gflag = "isntin";
	//	return [gflag, querystring];
	//
	//}
	//else
	{
	var KeyWordExistsAlreadyFlag = true;
	var querystring = "";
	var counter = 0;
		var gflag = "isntin";
		
		


		//if no keywords than set search word as keyword. This is a list of keywords 
		//so that the searhwords cant be used more than once 
		var storedArray2 = [searchword];
		var storedArray = [];
		
		//debugger;
		//there are no keywords
		if(!( storedArray = JSON.parse(sessionStorage.getItem("keywords"))))
		{
      
			KeyWordExistsAlreadyFlag = false;
			//put searchword into sessionstorage
			sessionStorage.setItem("keywords", JSON.stringify(storedArray2));
			storedArray = JSON.parse(sessionStorage.getItem("keywords"));
			
		//there already are keyword/s
		}else
		{
			storedArray = JSON.parse(sessionStorage.getItem("keywords"));
			//sessionStorage.setItem("keywords", JSON.stringify(storedArray));
			
			


		
		}

		//check for duplicate keywords, if duplicate leave and do nothing
		
		
		
		for (i = 0; i < storedArray.length; i++) {

			
			
			
			//isfirst == false: not a new keyword : just check keywords already saved
			
			//if (storedArray[i] == searchword && isfirst == false)
			if (storedArray[i] ==  searchword &&  KeyWordExistsAlreadyFlag == true )
			{
				
				gflag = "isin"
				querystring = ("var=" + searchword + "&");
				break;
			}
			
		}

		

		if(gflag == "isntin")
		{
			
			//storedArray.push(searchword);
			let id = sessionStorage.getItem("sessionUserID");
			sessionStorage.clear();	
			alert("is clear called1");
			
			
			sessionStorage.setItem("keywords", JSON.stringify(storedArray));
			sessionStorage.setItem("sessionUserID", id)
			
			

			querystring = ("var=" + searchword + "&");
		}
		
		
		
		
		
		
	
		
		
	
	return [gflag, querystring];
	 }
	}



//fix this, here, done   
/*function forBuildingHTML(result, searchText)
{
				//var item1 = val1
				var item = '"' + searchText + '"';
				
				var ourNewWord = "";
				
				var item2 = result.match(item);
				
				ourNewWord = result;//result.replace(item2, '');
				

				//var string = typeof(item1);
				
				//var x = typeof(item1);  // string
				//var y = typeof(string);	//string
				
				
				

return [ourNewWord];				
}
*/

//////

var gKeywordRecordNumber = 0;
//pressed return to purchase from template2
function displayOrdersTemplateAgain(){

	//debugger;
	



var querystring = "";




var counter = -1;
var array = [];



var gflag1 = 0;
//var gcounter1 = 0;

let keys = Object.keys(sessionStorage);




for(let key of keys) {

//	
//	

 if(key == "keywords")
  {
	counter++;
	
   
	let item = sessionStorage.getItem(key);
	
	
	array = JSON.parse(item);
   //console.log(array);

	//one iteration on fresh array
	for(var i = 0; i<array.length ; i++)
	{
	
	  querystring += "var=" + array[i] + "&";
    alert("array");
	  
	}

  }



  
  else if(key == "sessionUserID")
  {
		var item = sessionStorage.getItem(key);
		querystring += "uid=" + item + "&";
  }
  else if(key == "numberOfRecordsChosen")
  {

  }
  //else if(key == "alreadyZero")
  //{
//
 // }
  else if(key == "amtOfSelectdedRecords")
  {
	
	
	
  }
 
  //product id with amount to purchase
  else
  {
	var val1 = "";
	var item = sessionStorage.getItem(key);
	
	//dont build query with zero product "item"
	if(item == "0")
	{
		
		continue;
	}
	//else{

		
		//is a poduct or are products
		gflag1 = 1;
		
		
			querystring += "id=" + key + "&amtTryingToPurchase=" + item + "&";
		
	//}
	
  } 

}// end key loop

//no id quant
if (gflag1 == 0)
{
	//ALERT
	//alert("Alert : there are no products in session storage...");
	//return(1);
}




var url = "http://localhost:8080/displayOrdersTemplateAgain";
//var queryString = "user_name=jerry&password=666666&user_name=marry&password=11111";




			
			

			$.ajax({
			type:"POST",
			datatype: 'html',
			url:url,
			data:querystring,
			async:false,
			success: function (result) {

				
				
				
				


			//var retVals = [];
			//fix this, here, done :  two variables
			//var tempstringfortesting = "banana";
			//result is html of displaying orders again (after cartTemplate)

			//changed parameter two and commented out
			//retVals = forBuildingHTML(result , result.globKeyword);
			
			//fix this, here, done
			//var item1 = retVals[0];  
			
			var ourNewWord = result; 
			//var item = retVals[2];
			
			
			
			
			
			
			
			  
		




				//removes [var here],  builds secon cart template html, draws links to different keyword categories
			  for(var i = 0 ; i < array.length ; i++)
			  {

				
				


				alert("our rne word");
        console.log(array);
          //debugger;
        var val1 = 1; // '["' + array[i] +  '"]';
				
        console.log("our new word");
        console.log(ourNewWord);
				//html
				ourNewWord = ourNewWord.replace(val1 , '');
				//fix this, here
				//retVals = forBuildingHTML(ourNewWord);
				//create link to each keyword start
				var result1a = "<a href='#" + array[i] + "'>" + array[i] + "</a><br>";
				
				//positioning div at top of page
				document.getElementById('buttons').innerHTML   += result1a;
			  }
			  //positioning div at top of page
			  document.getElementById('templateOneHere').innerHTML   += ourNewWord;
			 
			}
		});

};

////////

function test(){

//alert("test here!");

let keys = Object.keys(sessionStorage);

for(let key of keys) {



	
//var keyAsInt = Number(key);


let value = false;
if (parseInt(key, 10))
{
	
	value = true;
}


if(key != "keywords" && key != "sessionUserID" && value == false) 
{
	
	

	sessionStorage.removeItem(key);	
}


}

sessionStorage.setItem("numberOfRecordsChosen", "0");



displayOrdersTemplateAgain();

	

return(1);

};

////////////// 

window.onload = function()
{	
	
}
/////////////


$(function (){

	
});


//any good code was here?

</script>


    </body>
    </html>