<html>


<body>
    <head>

		<title>Bootstrap Example</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	  <script src="node_modules/js-big-decimal/dist/web/js-big-decimal.min.js"></script>
    <!DOCTYPE html>

  </head> 


  <script>
//https://stackoverflow.com/questions/37426563/pass-golang-variables-into-javascript





    window.sessionStorage


////
function checkForPassword()
{
	var isThereACorrectPassword = sessionStorage.getItem("sessionUserID");
	
	//is no password
	if (!isThereACorrectPassword)
	{
		window.location.href = "login.html";
	}
	
}
////

	
	checkForPassword();

/////



  </script>

      <style>
      table, th, td {
        border: 1px solid black;
       
      }

      
      
      td {
        height: 80px;
        width: 160px;
        text-align: center;
        vertical-align: middle;
      }

      </style>
 

<br>
<div id = "linksHere"></div>
<br>

<div id = "buttonHere"></div>
<div id = "wholeTable" >
{{range .}}
<!-- display heading with this condition-->
{{if(eq .Condition 1)}}


<table style="width:60%; border:1px solid black;margin-left:auto;margin-right:auto;">

<tr>

<th><center>Amount to Buy</center></th>
<th><center>Product ID</center></th>
<th><center>Product Name</center></th>
<th><center>Category</center></th>
<th><center>Available</center></th> 
<th><center>Buying</center></th> 
<th><center>Cost for Each</center></th> 
<th><center>Total Cost Items With Tax</center></th> 

</tr>

{{end}}




 
<tr id = "{{.RemoveRecordDivID}}">

<td  > <center><p > <input  class = "V0"  id = "{{.AmountToBuyID}}"   value ="{{.Bought}}"   type="number" name="" placeholder="" size="8">	</p></center></td>
			
<!-- <td><center>{{.Condition}}  {{.RemoveRecordDivID}}</center> </td>-->

<td> <center><p> <input id = "{{.ProductIDID}}" value ="{{.ProductID}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

<td> <center><p> <input id = "" value ="{{.ProductName}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

<td> <center><p> <input id = "" value ="{{.ProductCatTitle}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>


  <td class = "" > <center><p> <input   id = "{{.DivID}}" value ="{{.ProductQuantity}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  <td> <center><p> <input id = "{{.BoughtID}}" value ="{{.Bought}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  
  <td> <center><p> <input id = "{{.CostID}}" value ="${{.ProductCost}}"  type="" name="" placeholder="" size="" >	</p></center></td>

  <td> <center><p> <input id = "{{.TotalCostID}}" value = "${{.TotalCost}}"   type="" name="" placeholder="" size=""  >	</p></center></td>


</tr>








{{if(eq .Condition2 -1)}}

<!--dispaly totals when condition is -1-->

<tr>
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td> 
<td> <center><p> <input class = "SameValue" id = "{{.GrandTotalStringID}}" value = "Grand Total: ${{.GrandTotalString}}"   type="" name="" placeholder="test" size="40" readonly >	</p></center></td>
 </tr>

</table>
<!--value is: Exists -->
<div class="SameValue"  value = "{{.OneValue}}"  > </div>
<br><br>
<center><button onclick="checkAllAvailableProducts('{{.DivID}}' , '{{.GrandTotalString}}', '{{.GrandTotalStringID}}' )">Checkout</button></center>


    
    
{{end}}
{{end}}

</div>




<script >
//



//cart dispalys fine and refreshes fine, check no password
//
function checkPassword()
{
  let isThereACorrectPassword = sessionStorage.getItem("sessionUserID");
	//alert("pass");
  //alert(isThereACorrectPassword);
	//is no password
  //alert("here5");
  //alert(isThereACorrectPassword);
	if (!isThereACorrectPassword)
	{
    //alert("this is wrong");
    
	window.location.href = "login.html";
 //alert("pass");
	}
	else
  {
    window.location.href  = "index.html"
  
  }
  
}


//fromCallTemplate

//window.onload = function()

$(function()
{
 
  document.getElementById("wholeTable").style.display = 'none';
  
  checkPassword();
  
})


      </script>

      <script>



function hideRow(rowId)
{
    document.getElementById(rowId).style.display = "none";
}




const initialValues = [];

var initialAmt1 = 0;

var grandTotalAccumulator = 0.0;
let grandTotalString = 0.0;
//checkout pressed from template2

let TotaledAtLeastOnceFLag = false;



/*
function checkAllAvailableProducts(quantity, gtotal, grandTotalID){


  let grandTotal = new bigDecimal("1.0");
  let grandTotal1 = "";// new bigDecimal("1.0");
  let total = "";
  //var gTotalNum1 = "";

  var gTotalNum1 = new  bigDecimal("1.0");
                
  
  


  var gtotal = parseFloat(gtotal);
  

  //leading letter for ids that are used in cart template
  var val1 = "";
  
  var var1 = "A";
  
  var var2 = "C";
 
  var var3 = "D"; 

  var var4 = "B";

  var var5 = "V";

  var var6 = "P";

  var counter = -1;
  var string = "";

  var item = 0;
  var AmountToBuyID = 0;
  var AmountOfCostID = 0;
  var AmountOfQuantityID = 0; 
  var bought = 0;
  
    
    var flagToReturnOut = false;
    let keys = Object.keys(sessionStorage);
    
    var amtOfHiddenProducts = 0;

    //each iteration is one purchase
    for(let key of keys) {
        counter++;
        if(key =="sessionUserID")
        {
          counter--;
         
          continue;
        }
        
        if(key =="keywords")
        {
          counter--;
          
          continue;
        }
        if(key =="numberOfRecordsChosen")
        {
          counter--;
         
          continue;
        }
        //if(key =="alreadyZero")
        //{
        //  counter--;
        // 
        //  continue;
        //}
        if(key =="amtOfKeywords")
        {
          counter--;
         
          continue;
        }

       

        
        //if here, is productid and a quantity
        AmountToBuyID = var1 + counter;
        AmountOfCostID = var2 + counter;
        AmountOfQuantityID = var3 + counter;
        BoughtID = var4 + counter;
        oneDivID = var5 + counter;
        ProductIDID = var6 + counter;
      
        var bought = (document.getElementById(BoughtID).value);
        var amtInBuyBox =(document.getElementById(AmountToBuyID).value);
        var quantityInBox = (document.getElementById(AmountOfQuantityID).value);
        var costInBox = (document.getElementById(AmountOfCostID).value); 
        var Product = (document.getElementById(ProductIDID).value); 
       
        var item = amtInBuyBox;
       
        
       
        //because amount to buy is nothing than change buying to nothing
        if (item == "")
        { 
          
          item = bought;
        
        }
        //check if is decimal
        if(item % 1 != 0)
        {
          
          return(1);
          
        }

        if(item == 0)
        {

                 
                  hideRow(oneDivID);
                  amtOfHiddenProducts++;
                 
          //continue;
          
        }
        
        else if(item < 0 ) 
        {
          
          //var str2 = amtInBuyBox.toString();
         
          flagToReturnOut= true;
        }
        else if (isNaN(item ))
        {
          
          //var str2 = amtInBuyBox.toString();
         
          flagToReturnOut= true;
        }

        
        if (flagToReturnOut == true)
        {
          return;
        }

        //id and amount trying to buy
        string =  string + "id=" + key + "&amtTryingToPurchase=" + item + "&";

       
          
        

    }//end


   
    
    //all products are hidden, so do this
    if (amtOfHiddenProducts == (counter + 1))
    {
      

      //window.location.href = "index.html";
      //window.location = "https://localhost/golangproj/index.html?displayOrdersTemplateAgain=1";

      
      //reset sessio variables because goint baack to index
      
      
      var sessID1 = sessionStorage.getItem("sessionUserID");
      alert("a");
      alert(sessID1);
      sessionStorage.clear();
      sessionStorage.setItem("sessionUserID", sessID1);
      sessionStorage.setItem("numberOfRecordsChosen", "0");
      

      
      window.location.href = "index.html";
      return(1);
      
      
    
    }
    //build string
    string = string + "userid=1&";//sessionStorage.getItem("sessionUserID");

    //removed &
var queryString = string;//.substring(0, string.length-1);

let flagisEnoughProduct = true;


              $.ajax({
              url: 'http://localhost:8080/sendBackNewCartData',
              type: 'GET',
              dataType: 'json',
              
              
              data:queryString,
              crossDomain: true,
             
              success: function (data) {
                

                

                //no records
                if(data.length == null){

                
                window.location.href = "index.html";
                return(1);
                //window.location.href = "index.html";
                 }

               
                for (var i = 0; i< data.length ;i++)
                {
                  
                  
                if(data[i].IsEnoughQuantity == false)
                {
              

                  

                  flagisEnoughProduct = false;
                  break;
                //flag = "not enough";
                
               
                }

                }

                


                if (flagisEnoughProduct == true)
                {
                  
                  window.location.href = "donePurchase.html";
                  return(1);
                }


                //if here, there is at least one record that doesnt have enough product
                

              var lengthOfData = data.length;

              
              
              console.log(data);


               
               
                for(var i = 0; i<(lengthOfData) ; i++)
                {

                 //for ids of carttemplate's ids
                var boughtid = "B" + i; 
                var buyThisManyID = "A" + i;
                var availableID =  "D" + i;
                var costID = "C" + i;
                var totalCostID = "TC" + i;
                var GrandTotalStringID = "GT" + i;
                var mainDivID =  "V" + i;
                
             
                var isEnoughQuantity = false;
                //still in loop
                isEnoughQuantity = data[i].IsEnoughQuantity;
                
               
               
                //wasnt enough, so make red


                if (isEnoughQuantity == false)
                {  
                  //debugger;
                  
                  //RED
                  //change settings of cart template if the current record doesn't have enough product in db for request 
                  var avail = (document.getElementById(availableID).value);
                  document.getElementById(buyThisManyID).value = 0;
                  let boughtValue = (document.getElementById(boughtid).value);
                  
                  
                  
                  document.getElementById(availableID).style.color = 'red';
                  
                  //amount to buy
                  document.getElementById(buyThisManyID).value = 0;
                  //buying
                  document.getElementById(boughtid).value = 0;
                  //total cost for productID
                  document.getElementById(totalCostID).value = "$0.00";
                  
                  document.getElementById(availableID).value = (parseInt(avail) + parseInt(boughtValue) );

                  //is enough quantity
                }else{
                
                  document.getElementById(availableID).style.color = 'black';
                  ///////
                  
                  //amount to buy
                  let amountToBuy1 = document.getElementById(buyThisManyID).value; //3
                 
                  costID = "C" + i;
                var totalCostID = "TC" + i;

                  //
                var a = 1/6
                //////////
                let parsedAmountToBuy1 = parseInt(amountToBuy1);

                document.getElementById(boughtid).value =  Number(parsedAmountToBuy1);
                document.getElementById(availableID).value = Number(document.getElementById(availableID).value) -  Number(parsedAmountToBuy1);  
                SetTotalCostAndSumGrandTotal(costID, boughtid, totalCostID);


                }

              }

              if (TotaledAtLeastOnceFLag == true)
              {
                setGrandTotal(GrandTotalStringID);
                TotaledAtLeastOnceFLag  = false;
              }

             

            
          }

          });
}//function
*/
///

                //https://www.bing.com/videos/search?q=decimal+math+javascript&docid=608053879316880106&mid=FA4CFF27446F37408541FA4CFF27446F37408541&view=detail&FORM=VIRE
                //https://www.npmjs.com/package/js-big-decimal
                //https://stackoverflow.com/questions/16742578/bigdecimal-in-javascript
                //debugger;
                function SetTotalCostAndSumGrandTotal(costID, boughtid, totalCostID)
                {
                  //debugger;
                 
                  TotaledAtLeastOnceFLag = true;
                //"$2232.60"
                let price = document.getElementById(costID).value;
                
                let boughtAmt =  document.getElementById(boughtid).value;
                let tax = .05;

                
                
                //"2232.00"
                let priceString = price.substring(1, price.length ); 
                //2232
                let priceNum = +priceString
                
                  
                //2232
                let totalCost1 = ((((priceNum)) * ((boughtAmt)*100)) / 100 );
                //2332
                let totalCost1Copy= totalCost1;
                //"2232.00"
                totalCost1 = totalCost1.toFixed(2);
                //"$2232.00"
                totalCost1String = "$" + totalCost1;
                

                document.getElementById(totalCostID).value = totalCost1String;

               
                //2232
                grandTotalAccumulator = (((grandTotalAccumulator * 100)  + ((totalCost1Copy) * 100))/100);
               

                return(true);
                }


            function setGrandTotal(GrandTotalStringID)
            {
                
            alert("setgrandtotal");
           // debugger;
           
           
            grandTotalAccumulatorWithTax = ((((.05) * 100) *  (grandTotalAccumulator * 100 )) )/10000;
             //223.4
            
            //round - is how sales tax is done!
            grandTotalAccumulatorWithTax = grandTotalAccumulatorWithTax.toFixed(2);
             //223.40
            
           
            grandTotalAccumulatorWithTax2 = ((Number(grandTotalAccumulatorWithTax) * 100) + (grandTotalAccumulator*100))/100;
             //4691.4
            //no more than 2 decimals before this
            grandTotalString = grandTotalAccumulatorWithTax2.toFixed(2);
            //"4691.40"
            grandTotalString = "$" + grandTotalString;
            //"$4691.40"
            document.getElementById(GrandTotalStringID).value = grandTotalString;
           
            
            }

          
                           


////

function test(){
let a = 1 / 3;
console.log("test");
console.log(a);

}





  


</script>

</body>
</html>